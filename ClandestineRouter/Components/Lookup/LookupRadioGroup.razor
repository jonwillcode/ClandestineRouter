@using ClandestineRouter.Services
@typeparam TLookup where TLookup : class, ILookupEntity
@inject ILookupService LookupService

<div class="mb-3">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="form-label">@Label</label>
    }
    @if (lookupItems != null)
    {
        @foreach (var item in lookupItems)
        {
            <div class="form-check">
                <input class="form-check-input" type="radio"
                       name="@GroupName" id="@($"{GroupName}_{item.Id}")"
                       value="@item.Id" checked="@(item.Id == SelectedValue)"
                       @onchange="@(() => OnSelectionChanged(item.Id))"
                       disabled="@Disabled" />
                <label class="form-check-label" for="@($"{GroupName}_{item.Id}")">
                    @item.Name
                </label>
            </div>
        }
    }
    @if (!string.IsNullOrEmpty(ValidationMessage))
    {
        <div class="invalid-feedback d-block">@ValidationMessage</div>
    }
</div>

@code {
    [Parameter] public string? Label { get; set; }
    [Parameter] public Guid? SelectedValue { get; set; }
    [Parameter] public EventCallback<Guid?> SelectedValueChanged { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public string? ValidationMessage { get; set; }
    [Parameter] public string GroupName { get; set; } = Guid.NewGuid().ToString();

    private List<TLookup>? lookupItems;

    protected override async Task OnInitializedAsync()
    {
        lookupItems = await LookupService.GetLookupItemsAsync<TLookup>();
    }

    private async Task OnSelectionChanged(Guid selectedId)
    {
        SelectedValue = selectedId;
        await SelectedValueChanged.InvokeAsync(selectedId);
    }
}
